# Lab0

## GCC内联汇编

```c
asm [volatile] ( Assembler Template
   : Output Operands	# 约束条件
   [ : Input Operands	# 约束条件
   [ : Clobbers ] ])
```

volatile：避免 “asm” 指令被删除、移动或组合，在执行代码时，如果不希望汇编语句被 gcc 优化而改变位置，就需要在 asm 符号后添加 volatile 关键词

示例：

```c
#define read_cr0() ({ \
unsigned int __dummy; \
__asm__( \
    "movl %%cr0,%0\n\t" \
    :"=r" (__dummy)); \
__dummy; \
})
```

数字前加前缀 “％“，如％1，％2等表示使用寄存器的样板操作数。具体的寄存器在前面加**两个“％”**，如**%%cr0**

输出部分：规定对输出变量（目标操作数）如何与寄存器结合的约束，输出部分可以有多个约束，互相以逗号分开。每个约束以“＝”开头，接着用一个字母来表示操作数的类型，然后是关于变量结合的约束。“＝r”表示相应的目标操作数（本例中的%0）可以使用任何一个通用寄存器，并且变量__dummy 存放在这个寄存器中。

输入部分：类似输出，但没有“=”。

常用寄存器的字母表示：

| 字母       | 含义                                             |
| ---------- | ------------------------------------------------ |
| m, v, o    | 内存单元                                         |
| R          | 任何通用寄存器                                   |
| Q          | 寄存器eax, ebx, ecx,edx之一                      |
| I, h       | 直接操作数                                       |
| E, F       | 浮点数                                           |
| G          | 任意                                             |
| a, b, c, d | 寄存器eax/ax/al, ebx/bx/bl, ecx/cx/cl或edx/dx/dl |
| S, D       | 寄存器esi或edi                                   |
| I          | 常数（0～31）                                    |